<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #2185ff, #6ab3ff);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .autocomplete-suggestions {
      position: absolute;
      background: white;
      border-radius: 0.375rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      max-height: 200px;
      overflow-y: auto;
      width: 100%;
      z-index: 10;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .autocomplete-suggestions.show {
      opacity: 1;
      transform: translateY(0);
    }
    .autocomplete-suggestion {
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
      border-bottom: 1px solid #f1f5f9;
    }
    .autocomplete-suggestion:last-child {
      border-bottom: none;
    }
    .autocomplete-suggestion:hover {
      background-color: #e2e8f0;
    }
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 20;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal.show {
      opacity: 1;
      visibility: visible;
    }
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 0.75rem;
      max-width: 600px;
      width: 90%;
      position: relative;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    .modal.show .modal-content {
      transform: scale(1);
    }
    .search-icon {
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    .search-input {
      transition: all 0.3s ease;
    }
    .search-input:focus {
      box-shadow: 0 0 0 3px rgba(33, 133, 255, 0.3);
      transform: translateY(-2px);
    }
    .logo-container {
      margin-bottom: 2rem;
      text-align: center;
    }
    .logo {
      max-width: 400px;
      height: auto;
      filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
    }
    .suggestion-highlight {
      background-color: #e2e8f0;
      padding: 0.1rem 0.2rem;
      border-radius: 0.25rem;
    }
    .content-match {
      font-size: 0.875rem;
      color: #64748b;
      margin-top: 0.25rem;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .content-highlight {
      background-color: #fef3c7;
      padding: 0.1rem 0.2rem;
      border-radius: 0.25rem;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

  <div class="logo-container">
    <img src="https://raw.githubusercontent.com/TreviumNL/Documentatie/refs/heads/main/treviumdocs.png" alt="Trevium" class="logo">
  </div>

  <div class="relative w-full max-w-lg">
    <input 
      id="search" 
      type="text" 
      placeholder="Typ om te zoeken..." 
      class="w-full p-4 rounded-lg shadow-lg focus:outline-none text-gray-800 search-input"
    >
    <div id="suggestions" class="autocomplete-suggestions"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <button id="closeModal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold transition-colors duration-200">&times;</button>
      <h2 id="modalTitle" class="text-2xl font-bold mb-4 text-gray-800"></h2>
      <div id="modalContent" class="text-gray-700 leading-relaxed"></div>
    </div>
  </div>

  <script>
    const searchInput = document.getElementById('search');
    const suggestionsBox = document.getElementById('suggestions');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalContent = document.getElementById('modalContent');
    const closeModal = document.getElementById('closeModal');

    let data = [];

    // Laad externe JSON vanuit Docs/docs.json
    fetch('https://raw.githubusercontent.com/TreviumNL/Documentatie/refs/heads/main/Docs/doc.json')
      .then(response => response.json())
      .then(json => { 
        data = json; 
        console.log('Data loaded:', data); // Voor debugging
        
        // Controleer of er een titel parameter is in de URL
        checkUrlForTitle();
      })
      .catch(error => {
        console.error('Error loading JSON:', error);
        // Fallback data als de fetch faalt
        data = [
          { title: "Welkom", content: "Dit is de documentatie zoekpagina. Typ in het zoekveld om te beginnen met zoeken." },
          { title: "Installatie", content: "Volg deze stappen om de applicatie te installeren." },
          { title: "Gebruikershandleiding", content: "Leer hoe je de applicatie effectief kunt gebruiken." }
        ];
        
        // Controleer of er een titel parameter is in de URL
        checkUrlForTitle();
      });

    // Functie om URL parameters te controleren
    function checkUrlForTitle() {
      const urlParams = new URLSearchParams(window.location.search);
      const titleParam = urlParams.get('titel');
      
      if (titleParam) {
        // Zoek het item met de opgegeven titel
        const item = data.find(item => 
          item.title.toLowerCase() === titleParam.toLowerCase()
        );
        
        if (item) {
          // Open de modal met het gevonden item
          openModal(item);
        }
      }
    }

    searchInput.addEventListener('input', () => {
      const query = searchInput.value.toLowerCase();
      suggestionsBox.innerHTML = '';
      
      if (!query) {
        suggestionsBox.classList.remove('show');
        return;
      }

      const filtered = data.filter(item => 
        item.title.toLowerCase().includes(query) || 
        item.content.toLowerCase().includes(query)
      ).slice(0, 10); // Max 10 suggesties

      if (filtered.length === 0) {
        suggestionsBox.classList.remove('show');
        return;
      }

      filtered.forEach(item => {
        const div = document.createElement('div');
        div.classList.add('autocomplete-suggestion');
        
        // Markeer de overeenkomende tekst in de titel
        const title = item.title;
        const titleQueryIndex = title.toLowerCase().indexOf(query);
        
        let titleHtml = title;
        if (titleQueryIndex !== -1) {
          const before = title.substring(0, titleQueryIndex);
          const match = title.substring(titleQueryIndex, titleQueryIndex + query.length);
          const after = title.substring(titleQueryIndex + query.length);
          
          titleHtml = `${before}<span class="suggestion-highlight">${match}</span>${after}`;
        }
        
        // Markeer de overeenkomende tekst in de content (voor de preview)
        const content = item.content;
        const contentQueryIndex = content.toLowerCase().indexOf(query);
        
        let contentHtml = '';
        if (contentQueryIndex !== -1) {
          const start = Math.max(0, contentQueryIndex - 20);
          const end = Math.min(content.length, contentQueryIndex + query.length + 40);
          let preview = content.substring(start, end);
          
          if (start > 0) preview = '...' + preview;
          if (end < content.length) preview = preview + '...';
          
          const previewQueryIndex = preview.toLowerCase().indexOf(query);
          const beforeContent = preview.substring(0, previewQueryIndex);
          const matchContent = preview.substring(previewQueryIndex, previewQueryIndex + query.length);
          const afterContent = preview.substring(previewQueryIndex + query.length);
          
          contentHtml = `<div class="content-match">${beforeContent}<span class="content-highlight">${matchContent}</span>${afterContent}</div>`;
        }
        
        div.innerHTML = `<div>${titleHtml}</div>${contentHtml}`;
        
        div.addEventListener('click', () => {
          searchInput.value = '';
          suggestionsBox.classList.remove('show');
          openModal(item);
          
          // Update de URL met de titel parameter
          const newUrl = new URL(window.location);
          newUrl.searchParams.set('titel', item.title);
          window.history.pushState({}, '', newUrl);
        });
        suggestionsBox.appendChild(div);
      });

      suggestionsBox.classList.add('show');
    });

    document.addEventListener('click', (e) => {
      if (!e.target.closest('#search') && !e.target.closest('.autocomplete-suggestion')) {
        suggestionsBox.classList.remove('show');
      }
    });

    function openModal(item) {
      modalTitle.textContent = item.title;
      modalContent.textContent = item.content;
      modal.classList.add('show');
    }

    closeModal.addEventListener('click', () => {
      modal.classList.remove('show');
      
      // Verwijder de titel parameter uit de URL bij sluiten
      const newUrl = new URL(window.location);
      newUrl.searchParams.delete('titel');
      window.history.pushState({}, '', newUrl);
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.remove('show');
        
        // Verwijder de titel parameter uit de URL bij sluiten
        const newUrl = new URL(window.location);
        newUrl.searchParams.delete('titel');
        window.history.pushState({}, '', newUrl);
      }
    });

    // Focus op het zoekveld wanneer de pagina laadt
    window.addEventListener('load', () => {
      searchInput.focus();
    });
  </script>

</body>
</html>
